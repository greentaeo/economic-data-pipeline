name: Daily Data Collection ğŸ“ˆ

# ì–¸ì œ ì‹¤í–‰í• ê¹Œ?
on:
  schedule:
    # ë§¤ì¼ ì•„ì¹¨ 10ì‹œ 00ë¶„ (í•œêµ­ ì‹œê°„ ê¸°ì¤€)
    # UTC ê¸°ì¤€ 01:00 = KST 10:00 (ë¯¸êµ­ ì£¼ì‹ ì¥ ë§ˆê° í›„ ë°ì´í„° ìˆ˜ì§‘)
    - cron: '0 1 * * *'
  # ìˆ˜ë™ìœ¼ë¡œë„ ì‹¤í–‰í•  ìˆ˜ ìˆê²Œ ë²„íŠ¼ ë§Œë“¤ê¸°
  workflow_dispatch:

jobs:
  collect-data:
    runs-on: ubuntu-latest  # ê¹ƒí—ˆë¸Œì˜ ë¦¬ëˆ…ìŠ¤ ì»´í“¨í„° ë¹Œë ¤ì“°ê¸°

    steps:
    # 1. ì½”ë“œ ê°€ì ¸ì˜¤ê¸°
    - name: Checkout code
      uses: actions/checkout@v3

    # 2. íŒŒì´ì¬ ì„¤ì¹˜í•˜ê¸°
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    # 3. ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜í•˜ê¸° (ì£¼ë¬¸ì„œëŒ€ë¡œ)
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    # 4. ìˆ˜ì§‘ê¸° ì‹¤í–‰í•˜ê¸°! (ê°€ì¥ ì¤‘ìš”)
    - name: Run Tiingo Collector
      env:
        # ì•„ê¹Œ ë§¡ê²¨ë‘” ë¹„ë°€ ì—´ì‡  êº¼ë‚´ì„œ ì“°ê¸°
        TIINGO_API_KEY: ${{ secrets.TIINGO_API_KEY }}
        SUPABASE_DB_URI: ${{ secrets.SUPABASE_DB_URI }}
      run: |
        # ìš°ë¦¬ê°€ ë§Œë“  ìˆ˜ì§‘ê¸° ì‹¤í–‰
        python scripts/collection/03_tiingo_etf_collector.py