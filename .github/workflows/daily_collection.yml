name: Daily Stock Collection

# 1. 언제 실행할지 설정
on:
  schedule:
    # 매일 한국 시간 오전 7시 (UTC 22:00) 실행
    # 전날 장 마감 데이터가 확실히 들어온 후 수집
    - cron: '0 22 * * *'
  # 수동으로 버튼 눌러서 실행 가능하게 함 (테스트용)
  workflow_dispatch:

jobs:
  collect-data:
    runs-on: ubuntu-latest

    steps:
    # 1) 코드 내려받기
    - name: Checkout code
      uses: actions/checkout@v3

    # 2) 파이썬 3.11 설치
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    # 3) 라이브러리 설치
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    # 4) 수집 스크립트 실행
    # (주의: 파일명을 님이 저장한 파일명으로 맞춰주세요! 예: collect_stock_data.py)
    - name: Run Collection Script
      env:
        SUPABASE_DB_URI: ${{ secrets.SUPABASE_DB_URI }}
        TIINGO_API_KEY: ${{ secrets.TIINGO_API_KEY }}
      run: |
        python collect_stock_data.py